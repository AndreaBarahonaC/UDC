---
title: "Tidyquant"
author: 
  - Miguel Flores
  - Andrea Barahona
  - Fabián Encarnación
  - Dario Quishpe
date: "`r Sys.Date()`"
output: 
  rmdformats::readthedown
---
Link:
https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ02-quant-integrations-in-tidyquant.html
1: Descripcion General, Requisitos previos, 1. Compatibilidad de Funciones, todo hasta Ejemplo 1.
2: Ejemplo 2 hasta ejemplo 4
3: eJEMPLO 5 HASTA ejemplo 7

1. Andrea 
2. Fabian
3. Dario

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(tidyquant)
```

# Descripción general
# Requisitos previos
# 1. Compatibilidad de funciones
## Funcionalidad zoo
## Funcionalidad xts
## Funcionalidad quantmod
## Funcionalidad TTR
## Funcionalidad PerformanceAnalytics
# 2. Poder cuantitativo en acción


```{r}
data("FANG")
FANG
```

## Ejemplo 1: utilice quantmod periodReturn para convertir precios en rentabilidad
## Ejemplo 2: utilice xts to.period para cambiar la periodicidad de diaria a mensual

La función `xts::to.period` se utiliza para convertir la periodicidad de un nivel inferior a un nivel superior (ej: meses a años). Dado que se busca una estructura que tenga una escala de tiempo diferente a la de entrada, se debe hacer una transformación. Utilizamos `tq_transmute()`, pasamos las columnas "open", "high", "low", "close" y "volume", y usamos el periodo "months".

```{r}
FANG |>  group_by(symbol) |> tq_transmute(select = open:volume,
                                mutate_fun = to.period,
                                period = "months")
```

Podemos comparar la visualización gráfica agrupando y sin agrupas:

**Sin agregración de periodicidad**

```{r}
FANG_diario <- FANG |> group_by(symbol) 
FANG_diario |> ggplot(aes(x=date, y=adjusted, color = symbol))+
               geom_line(linewidth = 1) +
               labs(title = "Precio diario de acciones",
                    x = "", y = "Precios ajustados", color = "")+
               facet_wrap(~ symbol, ncol = 2, scales = "free_y")+
               scale_y_continuous(labels = scales::dollar)+
               theme_tq()+
               scale_color_tq()
```

**Con agregación de periodicidad mensual**

```{r}
FANG_mensual <- FANG |>  group_by(symbol) |> tq_transmute(select = adjusted,
                                mutate_fun = to.period,
                                period = "months")
FANG_mensual |> ggplot(aes(x = date, y = adjusted, color = symbol)) +
                geom_line(linewidth = 1) + labs(title = "Monthly Stock Prices", x = "", y = "Adjusted Prices", color = "") +
                facet_wrap(~ symbol, ncol = 2, scales = "free_y") + scale_y_continuous(labels = scales::dollar) +
                theme_tq() + scale_color_tq()
```
Con esto se reduce la cantidad de puntos y el gráfico de la serie temporal se suaviza.

## Ejemplo 3: utilice TTR runCor para visualizar correlaciones continuas de rendimientos

Las correlaciones de rendimiento son una forma para analizar la medida en que un activo imita un índice de referencia. Utilizaremos los datos de `FANG` como los datos y la línea de base será el sector tecnológico "XLK", para ello se recupera los precios utilizando `tq_get`, y los rendimientos se calculan a partir de los precios ajustados del Ejemplo 1

```{r}
#Rendimientos
FANG_rend_mensual <- FANG |> group_by(symbol) |> 
                     tq_transmute(select = adjusted,
                                  mutate_fun = periodReturn,
                                  period = "monthly")
#Valor base de Rendimientos de referencia
base_rend_mensual <- "XLK" |> tq_get(get = "stock.prices",
                                            from = "2013-01-01",
                                            to = "2016-12-31") |> 
                              tq_transmute(select = adjusted,
                                           mutate_fun = periodReturn,
                                           period = "monthly")

#Unir 
rends <- left_join(FANG_rend_mensual, base_rend_mensual, by="date")
rends
```

La función `runCor` se puede utilizar para evaluar correlaciones rodantes, además se puede incluir el ancho de la correlación que en este caso utilizaremos seis al estar en una escala mensual. Se utilizará `tq_transmute_xy` para realizar esto:

```{r warning=FALSE}
FANG_corr <- rends |> tq_transmute_xy(x = monthly.returns.x,
                                   y = monthly.returns.y,
                                   mutate_fun = runCor,
                                   n = 6,
                                   col_rename = "corr_6")
#Grafico
FANG_corr |> ggplot(aes(x = date, y = corr_6, color = symbol))+
             geom_hline(yintercept = 0, color = palette_light()[[1]])+
             geom_line(size = 1)+
             labs(title = "FANG: Correlación 6 meses a XLK", x="", y="Correlation",color="")+
             facet_wrap(~symbol,ncol=2)+
             theme_tq()+scale_color_tq()
```

## Ejemplo 4: Utilice TTR MACD para visualizar la divergencia de convergencia de la media móvil
## Ejemplo 5: utilice xts apply.quarterly para obtener el precio máximo y mínimo para cada trimestre
## Ejemplo 6: utilice zoo rollapply para visualizar una regresión continua
## Ejemplo 7: utilice return.clean y return.excess para limpiar y calcular el exceso de rendimiento

